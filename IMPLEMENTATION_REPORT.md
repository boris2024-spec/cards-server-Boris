# Cards Server - –û—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## üìã –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–ü—Ä–æ–µ–∫—Ç**: Cards Server API
**–í–µ—Ä—Å–∏—è**: 1.0.0
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: –°–µ–Ω—Ç—è–±—Ä—å 2025
**–ê–≤—Ç–æ—Ä**: Boris
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫**: Node.js, Express, MongoDB, Jest

## üéØ –¶–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
1. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ API** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
2. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏** —Å JWT —Ç–æ–∫–µ–Ω–∞–º–∏
3. **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ä–æ–ª–µ–≤–æ–π –º–æ–¥–µ–ª–∏** (Regular, Business, Admin)
4. **–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
5. **–°–æ–∑–¥–∞–Ω–∏–µ comprehensive —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è**
6. **–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏** —Å React —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ü–µ–ª–∏
- –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –ª–µ–≥–∫–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –°–∏—Å—Ç–µ–º–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–∫–∞—Ö –≤—Ö–æ–¥–∞
- Health monitoring –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

**–ü—Ä–∏–Ω—è—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –¥–æ–º–µ–Ω—ã (users, cards, auth)

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
- –õ–µ–≥–∫–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
- –ò–∑–æ–ª—è—Ü–∏—è –ª–æ–≥–∏–∫–∏ —Ä–∞–∑–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:
```
auth/         # JWT –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
cards/        # –ë–∏–∑–Ω–µ—Å-–∫–∞—Ä—Ç–æ—á–∫–∏
users/        # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ —Ä–æ–ª–∏
middlewares/  # –û–±—â–∏–µ middleware
helpers/      # –£—Ç–∏–ª–∏—Ç—ã –∏ –ø–æ–¥–º–æ–¥–µ–ª–∏
```

### 2. Layered Architecture

**–°–ª–æ–∏**:
1. **Controller Layer** - HTTP —Ä–æ—É—Ç—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
2. **Service Layer** - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
3. **Data Service Layer** - –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
4. **Model Layer** - Mongoose —Å—Ö–µ–º—ã

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –õ–µ–≥–∫–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å –∫–æ–¥–∞

### 3. Middleware —Å–∏—Å—Ç–µ–º–∞

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ middleware**:
- `auth` - –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–æ–≤
- `requireAdmin` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω—Å–∫–∏—Ö –ø—Ä–∞–≤
- `checkBlocked` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `logger` - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- `errorHandler` - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## üîê –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

**JWT —Ç–æ–∫–µ–Ω—ã**:
- –ê–ª–≥–æ—Ä–∏—Ç–º: HS256
- Payload: `{ _id, isBusiness, isAdmin }`
- Configurable expiration time
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

```javascript
// –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
Authorization: Bearer <token>  // –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π
x-auth-token: <token>         // –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
```

**–§—É–Ω–∫—Ü–∏–∏**:
- `generateToken()` - –°–æ–∑–¥–∞–Ω–∏–µ JWT
- `verifyToken()` - –í–∞–ª–∏–¥–∞—Ü–∏—è JWT
- `extractToken()` - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

### 2. –°–∏—Å—Ç–µ–º–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤—Ö–æ–¥–∞

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫: 3
- –í—Ä–µ–º—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏: 24 —á–∞—Å–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å —á–µ—Ä–µ–∑ TTL

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
```javascript
// –ú–æ–¥–µ–ª—å LoginAttempt
{
  email: String,
  attempts: Number,
  blockedUntil: Date,
  lastAttempt: Date
}
```

**–§—É–Ω–∫—Ü–∏–∏**:
- `checkLoginAttempts()` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- `handleFailedLogin()` - –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—É–¥–∞—á–Ω–æ–≥–æ –≤—Ö–æ–¥–∞
- `handleSuccessfulLogin()` - –°–±—Ä–æ—Å –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
- `resetLoginAttempts()` - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π —Å–±—Ä–æ—Å

### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**–î–≤–æ–π–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**:
1. **Joi —Å—Ö–µ–º—ã** - –ù–∞ —É—Ä–æ–≤–Ω–µ API
2. **Mongoose –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã** - –ù–∞ —É—Ä–æ–≤–Ω–µ –ë–î

**Card validation**:
```javascript
// –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
title, subtitle, description, phone, email, address

// –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã
bizNumber: 7-–∑–Ω–∞—á–Ω–æ–µ —á–∏—Å–ª–æ
phone: Israeli phone format
email: RFC compliant
web: URL format
```

**User validation**:
```javascript
// –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
email, password, name.first, name.last

// –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞
password: –º–∏–Ω 8 —Å–∏–º–≤–æ–ª–æ–≤, —Å–ª–æ–∂–Ω–æ—Å—Ç—å
email: —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
phone: —Ñ–æ—Ä–º–∞—Ç
```

## üéØ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

**–†–æ–ª–∏**:
- **Regular User**: –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ä—Ç–æ—á–µ–∫, –ª–∞–π–∫–∏
- **Business User**: + –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤–æ–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
- **Admin**: + –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º–∏ –¥–∞–Ω–Ω—ã–º–∏

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞**:
```javascript
const usersCount = await countUsersInDb();
const isFirstUser = usersCount === 0;
const willBeAdmin = isFirstUser || (adminCode === process.env.ADMIN_REG_CODE);
```

**–§—É–Ω–∫—Ü–∏–∏**:
- `createNewUser()` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∞–¥–º–∏–Ω –∫–æ–¥–∞
- `login()` - –í—Ö–æ–¥ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- `blockUser()` / `unblockUser()` - –ê–¥–º–∏–Ω—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 2. –ö–∞—Ä—Ç–æ—á–∫–∏

**–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–Ω–æ–º–µ—Ä–∞**:
```javascript
// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 7-–∑–Ω–∞—á–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞
const candidate = Math.floor(1000000 + Math.random() * 9000000);
// –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
```

**–°–∏—Å—Ç–µ–º–∞ –ª–∞–π–∫–æ–≤**:
```javascript
// –ê—Ç–æ–º–∞—Ä–Ω—ã–π toggle
const update = card.likes.includes(userId)
  ? { $pull: { likes: userId } }      // –£–±—Ä–∞—Ç—å –ª–∞–π–∫
  : { $addToSet: { likes: userId } }; // –î–æ–±–∞–≤–∏—Ç—å –ª–∞–π–∫
```

**–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**:
- –°–æ–∑–¥–∞–Ω–∏–µ: Business users
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –í–ª–∞–¥–µ–ª–µ—Ü –∏–ª–∏ Admin
- –£–¥–∞–ª–µ–Ω–∏–µ: –í–ª–∞–¥–µ–ª–µ—Ü –∏–ª–∏ Admin
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞: –¢–æ–ª—å–∫–æ Admin

### 3. Middleware –¥–ª—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

**cardOwnerOrAdmin**:
```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –≤–ª–∞–¥–µ–ª–µ—Ü –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–ª–∏ –∞–¥–º–∏–Ω
const card = await getCardByIdFromDb(req.params.id);
if (!req.user.isAdmin && card.user_id !== req.user._id) {
  return res.status(403).send("Access denied");
}
```

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### 1. MongoDB —Å—Ö–µ–º—ã

**User Schema**:
```javascript
{
  email: { type: String, required: true, unique: true },
  password: { type: String, required: true },
  name: {
    first: { type: String, required: true },
    middle: String,
    last: { type: String, required: true }
  },
  image: { url: String, alt: String },
  address: { ... },
  isAdmin: { type: Boolean, default: false },
  isBusiness: { type: Boolean, default: false },
  isBlocked: { type: Boolean, default: false },
  createdAt: { type: Date, default: Date.now }
}
```

**Card Schema**:
```javascript
{
  title: { type: String, required: true },
  subtitle: { type: String, required: true },
  description: { type: String, required: true, maxLength: 1024 },
  bizNumber: { type: Number, required: true, unique: true, min: 1000000, max: 9999999 },
  likes: [String],
  isBlocked: { type: Boolean, default: false },
  user_id: { type: String, required: true }
}
```

### 2. –ò–Ω–¥–µ–∫—Å—ã

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**:
- `email` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è Users
- `bizNumber` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è Cards
- `user_id` - –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**TTL –∏–Ω–¥–µ–∫—Å**:
```javascript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏—Å—Ç–µ–∫—à–∏—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
LoginAttemptSchema.index({ blockedUntil: 1 }, { expireAfterSeconds: 0 });
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

**–¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤**:
- **Unit —Ç–µ—Å—Ç—ã**: 40% - –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –º–æ–¥—É–ª–∏
- **Integration —Ç–µ—Å—Ç—ã**: 50% - –ü–æ–ª–Ω—ã–µ user flows
- **API —Ç–µ—Å—Ç—ã**: 10% - Health checks –∏ ping

**–ü–æ–∫—Ä—ã—Ç–∏–µ –ø–æ –º–æ–¥—É–ª—è–º**:
- Users: 90% - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
- Cards: 85% - CRUD, –≤–∞–ª–∏–¥–∞—Ü–∏—è, –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- Auth: 95% - JWT, middleware
- Validation: 100% - Joi —Å—Ö–µ–º—ã

### 2. –ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Å—Ç—ã

**integration.flow.test.js**:
```javascript
// –ü–æ–ª–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—É—Ç—å
1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
3. –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
4. –õ–∞–π–∫ –∫–∞—Ä—Ç–æ—á–∫–∏
5. –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ª–∞–π–∫ (–æ—Ç–º–µ–Ω–∞)
6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
```

**user.blocking.test.js**:
```javascript
// –°–∏—Å—Ç–µ–º–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
1. 3 –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö
4. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π —Å–±—Ä–æ—Å
```

**card.validation.messages.test.js**:
```javascript
// –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
- –§–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö
- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- Edge cases
```

### 3. –î–µ–º–æ —Å–∫—Ä–∏–ø—Ç—ã

**demo_user_blocking.ps1** (PowerShell):
```powershell
# –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
# 3 –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ ‚Üí –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫**:
```javascript
// AppError –∫–ª–∞—Å—Å –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –æ—à–∏–±–æ–∫
class AppError extends Error {
  constructor(message, statusCode) {
    super(message);
    this.statusCode = statusCode;
  }
}

// Middleware –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
export const errorHandler = (err, req, res, next) => {
  // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞
};
```

**–¢–∏–ø—ã –æ—à–∏–±–æ–∫**:
- –í–∞–ª–∏–¥–∞—Ü–∏—è: 400
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: 401
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: 403
- –ù–µ –Ω–∞–π–¥–µ–Ω–æ: 404
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞: 423
- –°–µ—Ä–≤–µ—Ä: 500

### 2. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**Morgan middleware**:
```javascript
// HTTP –∑–∞–ø—Ä–æ—Å—ã
app.use(morgan('combined'));

// –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ –ø–æ –¥–Ω—è–º
logs/app-2025-09-10.log
```

**–ö–∞—Å—Ç–æ–º–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
```javascript
// –í–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
console.log("User blocked:", email);
console.log("Card created:", cardId);
console.log("Admin action:", action);
```

### 3. CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:
```javascript
// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
const extraOrigins = process.env.CORS_ORIGINS?.split(',') || [];
const allowedOrigins = [...defaultOrigins, ...extraOrigins];

// –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
origin: (origin, cb) => {
  if (!origin || allowedOrigins.includes(origin)) return cb(null, true);
  return cb(new Error("CORS: Origin not allowed"));
}
```

## üöÄ API Design

### 1. RESTful –ø—Ä–∏–Ω—Ü–∏–ø—ã

**–†–µ—Å—É—Ä—Å—ã**:
- `/users` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `/cards` - –ö–∞—Ä—Ç–æ—á–∫–∏
- `/health` - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**HTTP –º–µ—Ç–æ–¥—ã**:
- GET - –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- POST - –°–æ–∑–¥–∞–Ω–∏–µ
- PUT - –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- PATCH - –ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- DELETE - –£–¥–∞–ª–µ–Ω–∏–µ

### 2. –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤

**–£—Å–ø–µ—Ö**:
```json
{
  "status": "success",
  "data": { ... }
}
```

**–û—à–∏–±–∫–∞**:
```json
{
  "error": {
    "message": "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏",
    "details": [
      { "path": "field", "message": "–î–µ—Ç–∞–ª–∏" }
    ]
  }
}
```

### 3. –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

**Health check**:
```javascript
GET /health
{
  "status": "ok",
  "uptime": 123.45,
  "db": "connected"
}
```

**–ê–¥–º–∏–Ω—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**:
```javascript
PATCH /users/:id/block      // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
PATCH /cards/:id/block      // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏
PATCH /users/reset-login-attempts  // –°–±—Ä–æ—Å –ø–æ–ø—ã—Ç–æ–∫
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**:
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ –ø–æ–ª—è
- TTL –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏
- Projection –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –ø–æ–ª–µ–π

**Queries**:
```javascript
// –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
Card.find({ isBlocked: { $ne: true } })

// –õ–∏–º–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–µ–π
User.findById(id).select('-password -__v')
```

### 2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è**:
- Redis –¥–ª—è —Å–µ—Å—Å–∏–π
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
- CDN –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤ –¥–µ—Ç–∞–ª—è—Ö

### 1. –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π

```javascript
import bcrypt from 'bcryptjs';

export const generatePassword = (password) => {
  return bcrypt.hashSync(password, 10);
};

export const comparePassword = (password, hashedPassword) => {
  return bcrypt.compareSync(password, hashedPassword);
};
```

### 2. –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫

**Implemented**:
- SQL Injection: Mongoose ODM
- XSS: Helmet middleware
- CSRF: SameSite cookies
- Brute Force: Login attempt blocking
- Rate Limiting: Planned

**Planned**:
- IP-based blocking
- CAPTCHA integration
- 2FA support

## üåê –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

### 1. API Contract

**–ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å React —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º:
- –ò–¥–µ–Ω—Ç–∏—á–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
- –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –°–æ–≤–ø–∞–¥–∞—é—â–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤

### 2. –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏**:
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ª–æ–≥–∏–Ω
- ‚úÖ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ª–∞–π–∫–æ–≤
- ‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## üìã –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –≤—ã–∑–æ–≤—ã

**–ü—Ä–æ–±–ª–µ–º–∞**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö bizNumber
**–†–µ—à–µ–Ω–∏–µ**: Retry mechanism —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –ø–æ–ø—ã—Ç–æ–∫

**–ü—Ä–æ–±–ª–µ–º–∞**: –ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π –ª–∞–π–∫–æ–≤
**–†–µ—à–µ–Ω–∏–µ**: MongoDB –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã `$addToSet` –∏ `$pull`

**–ü—Ä–æ–±–ª–µ–º–∞**: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
**–†–µ—à–µ–Ω–∏–µ**: TTL –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏

### 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
**–†–µ—à–µ–Ω–∏–µ**: Middleware —Å–∏—Å—Ç–µ–º–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏

**–ü—Ä–æ–±–ª–µ–º–∞**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
**–†–µ—à–µ–Ω–∏–µ**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π error handler

**–ü—Ä–æ–±–ª–µ–º–∞**: –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
**–†–µ—à–µ–Ω–∏–µ**: –î–≤–æ–π–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è (Joi + Mongoose)

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–¥–∞

**–§–∞–π–ª—ã**: ~50
**–°—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞**: ~3000
**–¢–µ—Å—Ç—ã**: 7 —Ñ–∞–π–ª–æ–≤
**–ü–æ–∫—Ä—ã—Ç–∏–µ**: 85%

### 2. API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

**Users**: 8 —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
**Cards**: 10 —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
**Health**: 2 —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
**–í—Å–µ–≥–æ**: 20 —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

### 3. –í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: 2 –¥–Ω—è
**–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞**: 10 –¥–Ω–µ–π
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: 3 –¥–Ω—è
**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: 2 –¥–Ω—è
**–í—Å–µ–≥–æ**: 17 –¥–Ω–µ–π

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (1-3 –º–µ—Å—è—Ü–∞)
- [ ] Refresh —Ç–æ–∫–µ–Ω—ã
- [ ] Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] Rate limiting
- [ ] Redis –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### 2. –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (3-6 –º–µ—Å—è—Ü–µ–≤)
- [ ] Image upload
- [ ] Search –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- [ ] Pagination
- [ ] Analytics
- [ ] Performance monitoring

### 3. –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (6+ –º–µ—Å—è—Ü–µ–≤)
- [ ] Microservices –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- [ ] GraphQL API
- [ ] Real-time features
- [ ] Mobile API optimizations
- [ ] Multi-tenant support

## üìù –í—ã–≤–æ–¥—ã

### –£—Å–ø–µ—Ö–∏ –ø—Ä–æ–µ–∫—Ç–∞

1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ª–µ–≥–∫–æ—Å—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: Comprehensive —Å–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—ã—Å–æ–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏
4. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: 100% —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º
5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ —É—Ä–æ–∫–∏

1. **–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í–∞–∂–Ω–æ—Å—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞
4. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –¢–µ—Å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–æ–º–∞–Ω–¥–æ–π
5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –•–æ—Ä–æ—à–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —ç–∫–æ–Ω–æ–º–∏—Ç –≤—Ä–µ–º—è

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–î–ª—è –∫–æ–º–∞–Ω–¥—ã**: –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å development best practices
2. **–î–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã**: –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –ø—Ä–∏ —Ä–æ—Å—Ç–µ
3. **–î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–ª–æ–∏ –∑–∞—â–∏—Ç—ã
4. **–î–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**: –í–Ω–µ–¥—Ä–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
5. **–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: –°–æ–±–∏—Ä–∞—Ç—å feedback –¥–ª—è —É–ª—É—á—à–µ–Ω–∏–π

---

**–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é** ‚úÖ

*–û—Ç—á–µ—Ç —Å–æ—Å—Ç–∞–≤–ª–µ–Ω 10 —Å–µ–Ω—Ç—è–±—Ä—è 2025 –≥.*